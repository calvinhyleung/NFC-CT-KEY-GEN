<html lang="en">
  <head>
    <meta name="google-signin-scope" content="profile email" />
    <meta
      name="google-signin-client_id"
      content="149540714264-qr31ptlecdrqh2sloksud4n6de013jnu.apps.googleusercontent.com"
    />
    <meta
      http-equiv="origin-trial"
      content="Ahent2KLVxl7SV7xpZQVqU4t+8epm5MzqIWhPnosrkYhTI0EsOCDKp8jXpEnQ62+pfF+G7Clgx/YdH8BZj+upAEAAABReyJvcmlnaW4iOiJodHRwczovL2NhbHZpbmh5bGV1bmcuY29tOjQ0MyIsImZlYXR1cmUiOiJXZWJORkMiLCJleHBpcnkiOjE1OTU5ODA3OTl9"
    />
    <script src="https://apis.google.com/js/platform.js" async defer></script>
  </head>
  <body>
    <h1>NFC Contact Tracing</h1>
    <div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
    <script>
      function onSignIn(googleUser) {
        // Useful data for your client-side scripts:
        var profile = googleUser.getBasicProfile();
        console.log("ID: " + profile.getId()); // Don't send this directly to your server!
        console.log("Full Name: " + profile.getName());
        console.log("Given Name: " + profile.getGivenName());
        console.log("Family Name: " + profile.getFamilyName());
        console.log("Image URL: " + profile.getImageUrl());
        console.log("Email: " + profile.getEmail());

        // The ID token you need to pass to your backend:
        var id_token = googleUser.getAuthResponse().id_token;
        console.log("ID Token: " + id_token);

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http://192.168.1.221.xip.io:3000/handle");
        xhr.setRequestHeader(
          "Content-Type",
          "application/x-www-form-urlencoded"
        );
        xhr.onload = function () {
          console.log("Signed in as: " + xhr.responseText);
        };
        xhr.send("idtoken=" + id_token);
      }
    </script>
    <a href="#" onclick="signOut();">Sign out</a>
    <script>
      function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
          console.log("User signed out.");
        });
      }
    </script>

    <button id="scanButton">Scan</button>

    <script>
      var ChromeSamples = {
        log: function () {
          var line = Array.prototype.slice
            .call(arguments)
            .map(function (argument) {
              return typeof argument === "string"
                ? argument
                : JSON.stringify(argument);
            })
            .join(" ");

          document.querySelector("#log").textContent += line + "\n";
        },

        clearLog: function () {
          document.querySelector("#log").textContent = "";
        },

        setStatus: function (status) {
          document.querySelector("#status").textContent = status;
        },

        setContent: function (newContent) {
          var content = document.querySelector("#content");
          while (content.hasChildNodes()) {
            content.removeChild(content.lastChild);
          }
          content.appendChild(newContent);
        },
      };
    </script>

    <div id="output" class="output">
      <div id="content"></div>
      <div id="status"></div>
      <pre id="log"></pre>
    </div>

    <script>
      log = ChromeSamples.log;

      if (!("NDEFReader" in window))
        ChromeSamples.setStatus(
          "Web NFC is not available.\n" +
            'Please make sure the "Experimental Web Platform features" flag is enabled on Android.'
        );
    </script>

    <script>
      scanButton.addEventListener("click", async () => {
        log("User clicked scan button");

        try {
          const reader = new NDEFReader();
          await reader.scan();
          log("> Scan started");

          reader.addEventListener("error", (event) => {
            log(`Argh! ${event.message}`);
          });

          reader.addEventListener("reading", ({ message, serialNumber }) => {
            log(`> Serial Number: ${serialNumber}`);
            log(`> Records: (${message.records.length})`);
          });
        } catch (error) {
          log("Argh! " + error);
        }
      });
      /*
      writeButton.addEventListener("click", async () => {
        log("User clicked write button");

        try {
          const writer = new NDEFWriter();
          await writer.write("Hello world!");
          log("> Message written");
        } catch (error) {
          log("Argh! " + error);
        }
      });
      */
    </script>
  </body>
</html>
